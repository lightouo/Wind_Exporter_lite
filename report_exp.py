from WindPy import w
import pandas as pd
import datetime

def up_or_down(num):
    if num < 0:
        return 'ä¸‹è·ŒðŸ“‰'
    else:
        return 'ä¸Šæ¶¨ðŸ“ˆ'

def report_export(date=datetime.datetime.now()):
    data_ = w.wsd("000001.SH,881001.WI", "pct_chg", date.strftime("%Y-%m-%d"), date.strftime("%Y-%m-%d"), "").Data[0]
    if None in data_:
        print('Warning: æŠ¥å‘Šå­˜åœ¨ç¼ºå¤±æ•°æ®ï¼Œè¯·æ£€æŸ¥çŽ°åœ¨æ•°æ®æ˜¯å¦å·²ç»å…¬å¸ƒ!')
    data_ = [round(i, 2) if i is not None else 0 for i in data_]
    # data_ = [1.2, -1.3]
    data_1 = pd.read_excel(f'./output/{date.strftime("%Y-%m-%d")}.xlsx',sheet_name='æ¯æ—¥',index_col=0).round(2)
    data_2 = pd.read_excel(f'./output/{date.strftime("%Y-%m-%d")}.xlsx',sheet_name='åŒä¸š',index_col=0).round(2)
    text_block_1 = f"""ðŸ“ã€å¸‚åœºæŒ‡æ•°è¡¨çŽ°ã€‘ðŸ“
ä¸Šè¯æŒ‡æ•°{up_or_down(data_[0])}ï¼š{abs(data_[0])}%
ä¸‡å¾—å…¨A{up_or_down(data_[1])}ï¼š{abs(data_[1])}%
    """
    text_block_2 = f"""ðŸŒ¼å¹³å®‰ç¿äº«æ–‡å¨±-é»„ç»´ï¼ˆ002450ï¼‰
æœ¬æ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['002450.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['002450.OF'])}%
è¿‘ä¸€æœˆ{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['002450.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['002450.OF'])}%
    """
    text_block_3 = f"""ðŸŒ¼å¹³å®‰ç­–ç•¥å…ˆé”‹-ç¥žçˆ±å‰ï¼ˆ700003ï¼‰
ä»Šæ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['700003.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['700003.OF'])}%
è¿‘ä¸€å¹´{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['700003.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['700003.OF'])}%
    """
    text_block_4 = f"""ðŸŒ¼å¹³å®‰è½¬åž‹åˆ›æ–°-ç¥žçˆ±å‰ï¼ˆ004390ï¼‰
ä»Šæ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['004390.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['004390.OF'])}%
è¿‘ä¸€å¹´{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['004390.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['004390.OF'])}%
    """
    text_block_5 = f"""ðŸŒ¼å¹³å®‰æƒ æ¾œçº¯å€ºAï¼ˆ007935ï¼‰
ä»Šæ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['007935.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['007935.OF'])}%
è¿‘ä¸€å¹´{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['007935.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1å¹´å‰)']['007935.OF'])}%
    """
    text_block_6 = f"""ðŸŒ¼å¹³å®‰ä½Žç¢³ç»æµŽ-ä½•æ°ï¼ˆ009878ï¼‰
ä»Šæ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['009878.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['009878.OF'])}%
è¿‘ä¸€æœˆ{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['009878.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['009878.OF'])}%
    """
    text_block_7 = f"""ðŸŒ¼å¹³å®‰åŒä¸šå­˜å•ï¼ˆ015645ï¼‰
æœ¬æ—¥{up_or_down(data_2['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡'][0])}ï¼š{abs(data_2['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡'][0])}%
è¿‘ä¸ƒå¤©å¹´åŒ–{up_or_down(data_2['è¿‘1å‘¨å›žæŠ¥'][0])}ï¼š{abs(data_2['è¿‘1å‘¨å›žæŠ¥'][0])}%
"""
    text_block_8 = f"""ðŸŒ¼å¹³å®‰å“è´¨ä¼˜é€‰-ç¥žçˆ±å‰ï¼ˆ014460ï¼‰
æœ¬æ—¥{up_or_down(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['014460.OF'])}ï¼š{abs(data_1['å½“æœŸå¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡']['014460.OF'])}%
è¿‘ä¸€æœˆ{up_or_down(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['014460.OF'])}ï¼š{abs(data_1['å¤æƒå•ä½å‡€å€¼å¢žé•¿çŽ‡(æˆªæ­¢æ—¥1æœˆå‰)']['014460.OF'])}%
"""
    data = f"""ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}

{text_block_1}
{text_block_2}
{text_block_3}
{text_block_4}
{text_block_5}
{text_block_6}
{text_block_7}
{text_block_8}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”å¹¿å‘è¯åˆ¸

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
æƒç›Šå¯åšæŒå®šæŠ•
{text_block_2}
{text_block_7}
ðŸ“ã€çº¯å€ºæŽ¨èã€‘ðŸ“
{text_block_5}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”ä¸­é‡‘è´¢å¯Œ

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_8}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”ç²¤å¼€è¯åˆ¸

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_3}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”å›½æµ·è¯åˆ¸

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_4}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”ä¸‡è”è¯åˆ¸

{text_block_1}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”æ‹›å•†è¯åˆ¸

{text_block_1}
ðŸ“ã€æ ¸å¿ƒå…¬å‹Ÿäº§å“ã€‘ðŸ“
{text_block_4}
{text_block_7}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_5}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”å›½ä¿¡è¯åˆ¸

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_6}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”å›½ç››è¯åˆ¸

{text_block_1}
ðŸ“ã€æŒè¥æ± äº§å“ã€‘ðŸ“
{text_block_4}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”é•¿åŸŽè¯åˆ¸

{text_block_1}
ðŸ“ã€è´§å¸+ã€‘
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]



ðŸ… å‡€å€¼æ’­æŠ¥{date.strftime('%m.%d')}â€”å®‰ä¿¡è¯åˆ¸
{text_block_1}
ðŸ“ã€æŒè¥ç²¾é€‰æ± ã€‘ðŸ“
è´§å¸+
{text_block_7}
å¹³å®‰åŸºé‡‘ä¸Žæ‚¨æºæ‰‹åŒè¡Œ
ç¥æ™šå®‰[æœˆäº®]
    """
    with open(f'./output/å‡€æŠ¥{date.strftime("%Y-%m-%d")}.txt', 'w', encoding='utf-8') as f:
        f.write(data)